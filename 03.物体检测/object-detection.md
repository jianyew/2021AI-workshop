# 2021 AI workshop - object detection



## å®éªŒ1ï¼šæ¢ç´¢ Rekognition custom label åŠŸèƒ½

### 0-ç¯å¢ƒå‡†å¤‡

1. ä¸‹è½½â€˜aidaycvdatasets.zipâ€™ï¼Œæœ¬å®éªŒä¸­é€‰å–å…¶ä¸­çš„â€˜rek-datasetâ€™ä½œä¸ºè®­ç»ƒæ•°æ®ã€‚

### 1-å®éªŒæ­¥éª¤

1. åˆ›å»ºè‡ªå®šä¹‰æ ‡ç­¾é¡¹ç›®ã€‚ç‚¹å‡»â€˜åˆ›å»ºé¡¹ç›®â€™ã€‚å¡«å†™é¡¹ç›®åç§°ï¼Œå¹¶åˆ›å»ºé¡¹ç›®ã€‚

![image001](image001.png)

![image002](image002.png)



2. è®¾ç½®æ•°æ®é›†ï¼šåˆ›å»ºæ•°æ®é›†ï¼Œæ•°æ®é›†åç§°å«â€œsfparcelsâ€,é€‰æ‹©â€˜ä»æ‚¨çš„è®¡ç®—æœºä¸Šä¼ å›¾åƒâ€™æ¥ä¸Šä¼ 8å¼ è®­ç»ƒæ•°æ®å›¾åƒã€‚

![image003](image003.png)



![image004](image004.png)

![image005](image005.png)

3. æ·»åŠ æ ‡ç­¾ï¼Œåªéœ€æ·»åŠ ä¸€ç§æ ‡ç­¾â€˜sfparcelâ€™ã€‚

![image006](image006.png)

4. ç‚¹å‡»â€˜Draw bounding boxâ€™è¿›å…¥å›¾åƒæ ‡æ³¨æ¨¡å¼ã€‚åœ¨æ¯ä¸€ä¸ªæ ·æœ¬ä¸Šæ ‡æ³¨å‡ºé¡ºä¸°å¿«é€’çš„è¾¹ç•Œæ¡†ã€‚æ•´ä½“æ ‡æ³¨å®Œæˆåï¼Œéœ€è¦ç‚¹å‡»â€˜Save Changesâ€™ä¿å­˜æ ‡æ³¨ç»“æœã€‚

![image007](image007.png)

![image008](image008.png)

![image009](image009.png)



5. ç‚¹å‡»â€˜è®­ç»ƒæ¨¡å‹â€™ï¼Œè¿›å…¥è®­ç»ƒæ¨¡å‹ç•Œé¢ï¼Œé€‰æ‹©ä¹‹å‰åˆ›å»ºçš„é¡¹ç›®ï¼Œå¹¶é€‰æ‹©å·²æ ‡æ³¨çš„æ•°æ®é›†ã€‚åŒæ—¶é€‰æ‹©â€˜æ‹†åˆ†è®­ç»ƒæ•°æ®é›†â€™ï¼Œé€‰æ‹©é»˜è®¤çš„æµ‹è¯•é›†åˆå 20%ã€‚

![image010](image010.png)

![image011](image011.png)



6. ç­‰å¾…æ¨¡å‹è®­ç»ƒç»“æœã€‚

![image012](image012.png)















## å®éªŒ2ï¼šä½¿ç”¨ Sagemaker GroundTruthåšæ•°æ®é›†æ ‡æ³¨

### 0-ç¯å¢ƒå‡†å¤‡

1. ä¸‹è½½â€˜aidaycvdatasets.zipâ€™ï¼Œæœ¬å®éªŒä¸­é€‰å–å…¶ä¸­çš„â€˜groundtruth-datasetâ€™ä½œä¸ºè®­ç»ƒæ•°æ®ã€‚

### 1-åˆ›å»ºå›¢é˜Ÿ

1. åœ¨sagemakeræ§åˆ¶å°ç‚¹å‡»â€œæ ‡ç­¾å·¥ä½œäººå‘˜â€è¿›å…¥åˆ›å»ºå›¢é˜Ÿç•Œé¢ã€‚

![image013](image013.jpg)

 

2. ç‚¹å‡»â€œç§æœ‰â€ è¿›å…¥ç§æœ‰å›¢é˜Ÿç•Œé¢ã€‚

a.   åœ¨ç§æœ‰å›¢é˜Ÿéƒ¨åˆ† ç‚¹å‡»â€œåˆ›å»ºç§æœ‰å›¢é˜Ÿâ€

![image014](image014.jpg)

 

b. è¾“å…¥â€œå›¢é˜Ÿåç§°â€ ï¼Œå…¶ä»–é€‰é¡¹ä¿æŒé»˜è®¤ï¼Œç‚¹å‡»â€œåˆ›å»ºç§æœ‰å›¢é˜Ÿâ€

3. åœ¨å·¥ä½œäººå‘˜éƒ¨åˆ† ç‚¹å‡»â€œé‚€è¯·å·¥ä½œäººå‘˜â€œ

![image015](image015.jpg)

 

 

 

![image016](image016.jpg)

 

a.   è¾“å…¥æ–°å·¥ä½œäººå‘˜çš„é‚®ä»¶åœ°å€ï¼Œç‚¹å‡»â€œé‚€è¯·æ–°å·¥ä½œäººå‘˜â€

![image017](image017.jpg)

 

b. ç³»ç»Ÿå°†å‘æ–°å·¥ä½œäººå‘˜é‚®ç®±å‘é€é‚€è¯·é‚®ä»¶ï¼Œè¯·æ–°å·¥ä½œäººå‘˜æ‰“å¼€é“¾æ¥ï¼Œæ›´æ”¹å¯†ç ï¼Œè¿›å…¥å·¥ä½œç•Œé¢ã€‚

![image018](image018.jpg)

 

![image019](image019.jpg)

4. åœ¨ç§æœ‰å›¢é˜Ÿç•Œé¢ï¼Œç‚¹å‡»æ–°åˆ›å»ºçš„å›¢é˜Ÿï¼Œè¿›å…¥å›¢é˜Ÿè¯¦æƒ…ç•Œé¢åï¼Œç‚¹å‡»â€œå‘å›¢é˜Ÿæ·»åŠ å·¥ä½œäººå‘˜â€

![image020](image020.jpg)

 

a.   ç‚¹å‡»è¦æ·»åŠ çš„ç»„å‘˜åˆ°å›¢é˜Ÿä¸­ã€‚

![image021](image021.jpg)



### 2-åˆ›å»ºä»»åŠ¡

1. ä¸‹è½½â€˜aidaycvdatasets.zipâ€™ï¼Œå¹¶ä½¿ç”¨å…¶ä¸­çš„â€˜groundtruth-datasetâ€™ä½œä¸ºè®­ç»ƒæ•°æ®ä½¿ç”¨ã€‚

2. æ‹†åˆ†æ–‡ä»¶å¤¹ï¼Œå°†jpgæ–‡ä»¶ä¸Šä¼ å›¾åƒæ–‡ä»¶åˆ°æ‰€åœ¨åŒºåŸŸçš„s3 bucketã€‚ä¸Šä¼ æ–‡ä»¶åˆ°ç»„é•¿è´¦å·çš„å­˜å‚¨æ¡¶å†…çš„æŒ‡å®šè·¯å¾„ä¸­ã€‚

![image022](image022.jpg)

 

3. ä½¿ç”¨æ‹¥æœ‰adminæƒé™çš„è´¦æˆ·è¿›è¡Œæ ‡è®°ä»»åŠ¡çš„åˆ›å»ºï¼Œæ£€æŸ¥å°ç»„é•¿çš„useræ˜¯å¦ä¸ºadminæƒé™

![image023](image023.jpg)

 

4. åˆ›å»ºæ ‡è®°ä½œä¸š

a.   åœ¨å·¦ä¾§å¯¼èˆªæ ä¸­ï¼Œé€‰æ‹© **Labeling jobs (**è´´æ ‡ä½œä¸š)ã€‚ 

b.   é€‰æ‹© **Create labeling job (**åˆ›å»ºæ ‡è®°ä½œä¸š) ä»¥å¼€å§‹ä½œä¸šåˆ›å»ºè¿‡ç¨‹ã€‚ 

c.   åœ¨ **Job overview (**ä½œä¸šæ¦‚è§ˆ) éƒ¨åˆ†ä¸­ï¼Œæä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š 

d.   **Job name (**ä½œä¸šåç§°) â€“ ä¸ºæ ‡è®°ä½œä¸šæä¾›ä¸€ä¸ªæè¿°æ­¤ä½œä¸šçš„åç§°ã€‚æ­¤åç§°å°†æ˜¾ç¤ºåœ¨ä½œä¸šåˆ—è¡¨ä¸­ã€‚è¯¥åç§°åœ¨æ‚¨çš„è´¦æˆ·å’Œ AWS åŒºåŸŸä¸­éƒ½å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ 

â€‹                        i.   **è¾“å…¥æ•°æ®è®¾ç½®** â€“ é€‰æ‹©**â€œ**è‡ªåŠ¨æ•°æ®è®¾ç½®â€ã€‚ 

â€‹                       ii.   **Input dataset location (**è¾“å…¥æ•°æ®é›†ä½ç½®) â€“ è¾“å…¥æ‚¨åœ¨æ­¥éª¤ 1 ä¸­åˆ›å»ºçš„æ¸…å•æ–‡ä»¶çš„ S3 ä½ç½®ã€‚ 

â€‹                      iii.    **è¾“å‡ºæ•°æ®é›†ä½ç½®** â€“ è¾“å‡ºæ•°æ®å°†å†™å…¥åˆ°çš„ä½ç½®ã€‚ 

â€‹                      iv.   **IAM** **è§’è‰²** â€“ é€‰æ‹©â€œåˆ›å»ºæ–°è§’è‰²â€ï¼Œè¾“å…¥è¾“å…¥æ•°æ®çš„s3æ¡¶çš„åç§°ï¼Œåˆ›å»ºåªå…è®¸è®¿é—®ç‰¹å®šs3æ¡¶çš„è§’è‰²ã€‚

 

![image024](image024.png)

![image025](image025.png)

![image026](image026.png)

![image027](image027.png)

 

![image028](image028.png)

 



![image029](image029.png)



e. åœ¨**ä»»åŠ¡ç±»å‹**éƒ¨åˆ†ï¼Œå¯¹äº **Dataset type (æ•°æ®é›†ç±»å‹)** å­—æ®µï¼Œé€‰æ‹© **è¾¹ç•Œæ¡†** ä½œä¸ºä»»åŠ¡ç±»å‹ã€‚ 

f. é€‰æ‹© **Next (**ä¸‹ä¸€æ­¥)ç»§ç»­é…ç½®æ‚¨çš„æ ‡è®°ä½œä¸šã€‚ 

![image030](image030.png)

 

g. å›¢é˜Ÿç±»å‹é€‰æ‹©â€œ**ç§æœ‰**â€ã€‚

h. åœ¨â€œ**å›¢é˜Ÿåç§°**â€è¾“å…¥ä¸Šä¸€æ­¥åˆ›å»ºçš„å›¢é˜Ÿåç§°ã€‚

![image031](image031.png)

 

 

i. åœ¨ä¸Šæ–¹æ–‡æœ¬æ¡†è¾“å…¥å¯¹æ­¤æ¬¡æ ‡è®°çš„æ¦‚è¿°ï¼Œä¾‹å¦‚â€œplease draw the bounding boxes with correct labels.â€

j. åœ¨å³ä¾§è¾“å…¥åŒ…è£…çš„ç§ç±»ï¼Œå¦‚â€œbottledâ€â€œcannedâ€ç­‰ï¼Œç‚¹å‡»æ·»åŠ æ ‡ç­¾å¯ä»¥æ·»åŠ æ–°æ ‡ç­¾ã€‚å¯ä»¥ç‚¹å‡»é¢„è§ˆè¿›è¡Œæ ‡è®°ç•Œé¢çš„é¢„è§ˆã€‚
 k. ç‚¹å‡»â€œåˆ›å»ºâ€å®Œæˆä»»åŠ¡åˆ›å»ºã€‚

![image032](image032.png)

 

l. ç­‰å¾…å‡ åˆ†é’Ÿåï¼Œå·¥ä½œäººå‘˜å¯ä»¥ç™»é™†åˆ°æ ‡ç­¾å·¥ä½œç•Œé¢è¿›è¡Œæ‰“æ ‡ç­¾å·¥ä½œã€‚

ç‚¹å‡»ç›¸åº”ä»»åŠ¡åï¼Œç‚¹å‡»start working

![image033](image033.png)

m. æ¥åˆ°æ ‡è®°ç•Œé¢ï¼Œç‚¹å‡»å³ä¾§ç›¸åº”çš„å›¾åƒlabel é€‰æ‹©ç›¸åº”çš„ç§ç±»ï¼Œç‚¹å‡»å³ä¸‹è§’çš„submitã€‚









## å®éªŒ3ï¼šä½¿ç”¨ Sagemaker Notebook å®ä¾‹è®­ç»ƒä¸€ä¸ªç›®æ ‡æ£€æµ‹çš„æ¨¡å‹


### 0-ç¯å¢ƒå‡†å¤‡

1. åˆ›å»ºS3æ¡¶
2. åˆ›å»ºIAM roleï¼Œèµ‹äºˆsagemakerå’Œs3çš„æƒé™

### 1- å¯åŠ¨Sagemakerç¬”è®°æœ¬å®ä¾‹

>æœ¬æ¬¡æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¼šç”¨çš„GPUå®ä¾‹ï¼Œç¡®è®¤è´¦æˆ·å…·æœ‰ç›¸åº”çš„æƒé™

1. ç™»å½•åˆ°æ§åˆ¶å°([https://console.aws.amazon.com/](https://console.amazonaws.cn/)) ï¼Œåˆ‡æ¢åŒºåŸŸåˆ°â€œap-northeast-1â€ï¼Œé€‰æ‹©SageMakeræœåŠ¡ä¸­çš„ç¬”è®°æœ¬å®ä¾‹

![object-dection-lab3-1](object-dection-lab3-1.png)




2. é€‰æ‹©åˆ›å»ºç¬”è®°æœ¬å®ä¾‹
  
   ![object-dection-lab3-2](object-dection-lab3-2.png)
   
   - ` ç¬”è®°æœ¬å®ä¾‹åç§° `ï¼šè‡ªå®šä¹‰åç§°
   
- ` ç¬”è®°æœ¬å®ä¾‹ç±»å‹ `ï¼šæ ¹æ®éœ€è¦å¯é€‰â€ml.t3.mediumâ€œ;
  
   ![object-dection-lab3-3](object-dection-lab3-3.png)
   
   - ` æƒé™å’ŒåŠ å¯†-IAMè§’è‰² `ï¼šæŒ‰é»˜è®¤â€åˆ›å»º IAM è§’è‰²â€œ,
   
   ![object-dection-lab3-4](object-dection-lab3-4.png)
   
   - å…¶ä½™é€‰é¡¹å¯ä»¥ä¿æŒé»˜è®¤
   - æœ€åç‚¹å‡» `åˆ›å»ºç¬”è®°æœ¬å®ä¾‹ `
   
   ![object-dection-lab3-5](object-dection-lab3-5.png)
   
3. æ‰“å¼€Sagemakerç¬”è®°æœ¬å®ä¾‹
    1. éœ€è¦è¯¥ç¬”è®°æœ¬å®ä¾‹çŠ¶æ€å˜æˆç»¿è‰²` InService` çš„å¯ç”¨çŠ¶æ€

    ![object-dection-lab3-6](object-dection-lab3-6.png)

    2. æ‰“å¼€Sagemakerç¬”è®°æœ¬å®ä¾‹ä¹‹åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

    ![object-dection-lab3-7](object-dection-lab3-7.png)


4. ä¸Šä¼ æœ¬æ¬¡å®éªŒçš„sample codeåˆ°Sagemakerç¬”è®°æœ¬å®ä¾‹
    1. ä¸‹è½½é“¾æ¥ğŸ”—[object_detection_demo.ipynb](https://staticweb-test-wqx.s3.amazonaws.com/sharefile/object_detection_demo.ipynb)
    2. å…ˆä¸‹è½½ä¸Šè¿°æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œç„¶åç‚¹å‡»Sagemakerç¬”è®°æœ¬å®ä¾‹çš„` upload` ï¼Œé€‰æ‹©ä¿å­˜æ–‡ä»¶çš„ä½ç½®ä»¥åŠæ–‡ä»¶å®Œæˆä¸Šä¼ 
    
    ![object-dection-lab3-8](object-dection-lab3-8.png)


5. æ‰“å¼€æœ¬æ¬¡å®éªŒçš„jupyter notebook


6. åœ¨æœ¬æ¬¡å®éªŒçš„jupyter notebookä¸­ä¾æ¬¡æ‰§è¡Œæ¯ä¸€ä¸ªä»£ç å—



***
## é™„å½•ï¼šç›¸å…³èµ„æ–™æ•´ç†

#### åŸºç¡€ï¼š

* SageMaker å®˜æ–¹æ–‡æ¡£ :  https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/whatis.html 
* AWS æœºå™¨å­¦ä¹ å¹³å° Amazon SageMaker è¯¦è§£[è§†é¢‘] : http://aws.amazon.bokecc.com/news/show-2442.html

#### Groudtruth åšæ•°æ®æ ‡è®°ï¼š

* 11ä½¿ç”¨Amazon SageMakeræ‰“é€ å‡†ç¡®çš„æ•°æ®æ ‡è®°é›†[è§†é¢‘] : http://aws.amazon.bokecc.com/news/show-2461.html
* Ground Truth å®˜æ–¹æ–‡æ¡£ï¼š https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/sms.html 

#### ä½¿ç”¨sagemaker notebookï¼š

* 1-ä½¿ç”¨Amazon SageMakeræ‰˜ç®¡çš„Jupyter Notebookå®ä¾‹[è§†é¢‘] : http://aws.amazon.bokecc.com/news/show-2464.html 
* 4ä½¿ç”¨Amazon SageMaker è®­ç»ƒæ¨¡å‹[è§†é¢‘] : http://aws.amazon.bokecc.com/news/show-2468.html
* å¼€å§‹ä½¿ç”¨ Amazon SageMaker ç¬”è®°æœ¬å®ä¾‹å®˜æ–¹æ–‡æ¡£ :  https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/gs-console.html 

#### è¶…å‚ä¼˜åŒ–ï¼š

* è¶…å‚æ•°æ¦‚å¿µä»‹ç»ï¼šhttps://www.jianshu.com/p/6602c76cc801
* 6ä½¿ç”¨Amazon SageMakerè¶…å‚è‡ªåŠ¨è°ƒä¼˜[è§†é¢‘] :ï¼šhttp://aws.amazon.bokecc.com/news/show-2469.html
* è¶…å‚æ•°è‡ªåŠ¨ä¼˜åŒ–å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/automatic-model-tuning.html